<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <title>Apex Triggers</title>
  <link rel="stylesheet" href="../test.css">
</head>

<body>
  <header>
    <h1>Apex Trigger Examples</h1>
  </header>

  <section>

    <!-- EXAMPLE 1 -->
    <div class="example">
      <p><span class="counter"></span> - Write a method for the trigger that updates the Rating field of a newly created
        Account to 'Hot' if the Industry field is 'Banking' or 'Healthcare'.</p>
      <button class="showSolution">Show Solution</button>
      <pre>
        public class HandlerClass {
          public static void updateRatingField(List&lt;Account&gt; listAcc){ <em> // listAcc represents Trigger.new </em>
            for(Account acc : listAcc){
               If(!Strinng.isBlank(acc.Industry) <span style='color:red'>&&</span> (acc.Industry == 'Banking' || acc.Industry == 'Healthcare')){
                  acc.Rating = 'Hot';
               }
           }
         }  
        }

        trigger AccountTrigger on Account (before insert) {
          if(Trigger.isBefore <span style='color:red'>&&</span> Trigger.isInsert){
            HandlerClass.updateRatingField(Trigger.new);
          }
        }      
      </pre>
    </div>

    <!-- EXAMPLE 2 -->
    <div class="example">
      <p><span class="counter"></span> - When a contact record is updated, write a trigger that changes the Description
        field to the profile name of the user who updated it.</p>
      <button class="showSolution">Show Solution</button>
      <pre>
        public class HandlerClass {
          public static void updateDescriptionField(List&lt;Contact&gt; conList){
            Profile profile = [SELECT Name FROM Profile WHERE Id = :UserInfo.getProfileId()];
            for(Contact con : conList){
                con.Description = 'This record was last updated by ' + profile.Name;
            }
          }        
        }

        trigger AccountTrigger on Account (before update) {
          if(Trigger.isBefore <span style='color:red'>&&</span> Trigger.isUpdate){
            HandlerClass.updateDescriptionField(Trigger.new);
          }
        }                     
      </pre>
    </div>

    <!-- EXAMPLE 3 -->
    <div class="example">
      <p><span class="counter"></span> - Please write a trigger that throws an error when a user wants to delete a
        contact record that is not related to any Account.</p>
      <button class="showSolution">Show Solution</button>
      <pre>
        public class HandlerClass {
          public static void contactDeleteError(List&lt;Contact&gt; conList){ <em> // conList represents Trigger.old</em> 
            for(Contact con : conList){
                If(String.isBlank(con.AccountId)){
                    con.addError('You have no permission to perform this action.');
                }
            }
          }              
        }

        trigger AccountTrigger on Account (before delete) {
          if(Trigger.isBefore <span style='color:red'>&&</span> Trigger.isDelete){
            HandlerClass.contactDeleteError(Trigger.old);
          }
        }              
        </pre>
    </div>

    <!-- EXAMPLE 4 -->
    <div class="example">
      <p><span class="counter"></span> - Send an email and notification to new owner when the owner of an account changes.</p>
      <button class="showSolution">Show Solution</button>
      <pre>
          public static void sendEmailAndNotification(List<Account> listAccount, Map<Id, Account> oldAccounts){
             List<Account> accounts = [SELECT Owner.Email FROM Account WHERE Id=:oldAccounts.keySet()];
            
             Map<Id, String> mapAccountOwners = new Map<Id, String>();
             for(Account acc:accounts){
                 mapAccountOwners.put(acc.Id, acc.Owner.Email);
             }        
    
             List<Messaging.Email> emails = new List<Messaging.Email>();
    
             for(Lead le:listLead){
                if(le.OwnerId != oldLeads.get(le.Id).OwnerId){                
                  Messaging.SingleEmailMessage email = new Messaging.SingleEmailMessage();
                  email.setSubject('Lead Owner');
                  email.setPlainTextBody(le.FirstName + ' ' + le.LastName + ' has been assigned to you.');
                  email.setToAddresses(new List<String>{mapLeadOwners.get(le.Id)});
                  emails.add(email);
               }    
           }
           Messaging.sendEmail(emails);  

           <em> // First, We must create a custom notification type.  </em>
           <em> // Get the Id for our custom notification type </em>
           CustomNotificationType notificationType = [SELECT Id FROM CustomNotificationType
                                           WHERE DeveloperName='Custom_Notification'];
                    
                    for(Lead le:listLead){
                        if(le.OwnerId != oldLeads.get(le.Id).OwnerId){
                           Messaging.CustomNotification notification= new Messaging.CustomNotification();
                           notification.setNotificationTypeId(notificationType.Id);
                           notification.setTitle('Lead Owner Changed');
                           notification.setBody(le.FirstName + ' ' + le.LastName + ' has been assigned to you.');
                           notification.setTargetId(le.Id);
                           notification.send(new Set<String>{le.OwnerId});
                        }    
                    }
          }
        </pre>
    </div>

  </section>

  <script src="examples.js"></script>

</body>

</html>
